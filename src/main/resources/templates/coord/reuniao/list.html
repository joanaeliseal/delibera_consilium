<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout :: layout(~{::section})}">
<body>
<section>
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="bi bi-calendar-event"></i> Reunioes do Colegiado</h2>
        <a th:href="@{/coord/reunioes/nova}" class="btn btn-primary">
            <i class="bi bi-plus-lg"></i> Nova Reuniao
        </a>
    </div>

    <!-- Filtros -->
    <div class="card mb-4 bg-light">
        <div class="card-body py-2">
            <form th:action="@{/coord/reunioes}" method="get" class="row g-3 align-items-end">
                <div class="col-md-4">
                    <label class="form-label">Status</label>
                    <select name="status" class="form-select">
                        <option value="">Todos</option>
                        <option th:each="s : ${statusList}" th:value="${s.name()}"
                                th:text="${s.name()}" th:selected="${s.name() == statusSelecionado}"></option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label class="form-label">Colegiado</label>
                    <select name="colegiadoId" class="form-select">
                        <option value="">Todos</option>
                        <option th:each="c : ${colegiados}" th:value="${c.id}"
                                th:text="${c.curso}" th:selected="${c.id == colegiadoSelecionado}"></option>
                    </select>
                </div>
                <div class="col-md-4">
                    <button type="submit" class="btn btn-primary me-2">
                        <i class="bi bi-search"></i> Filtrar
                    </button>
                    <a th:href="@{/coord/reunioes}" class="btn btn-outline-secondary">
                        <i class="bi bi-x-lg"></i> Limpar
                    </a>
                </div>
            </form>
        </div>
    </div>

    <!-- Tabela de Reunioes -->
    <div class="card">
        <div class="card-body p-0">
            <table class="table table-hover mb-0">
                <thead class="table-primary">
                    <tr>
                        <th>ID</th>
                        <th>Data</th>
                        <th>Colegiado</th>
                        <th>Status</th>
                        <th>Processos</th>
                        <th>Acoes</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="r : ${reunioes}">
                        <td th:text="${r.id}"></td>
                        <td th:text="${#temporals.format(r.dataReuniao, 'dd/MM/yyyy')}"></td>
                        <td th:text="${r.colegiado?.curso}"></td>
                        <td>
                            <span th:if="${r.status.name() == 'PROGRAMADA'}" class="badge bg-warning text-dark">
                                Programada
                            </span>
                            <span th:if="${r.status.name() == 'EM_ANDAMENTO'}" class="badge bg-primary">
                                Em Andamento
                            </span>
                            <span th:if="${r.status.name() == 'ENCERRADA'}" class="badge bg-success">
                                Encerrada
                            </span>
                        </td>
                        <td>
                            <span class="badge bg-secondary" th:text="${r.processosEmPauta != null ? r.processosEmPauta.size() : 0}"></span>
                        </td>
                        <td>
                            <!-- Acoes para reuniao PROGRAMADA -->
                            <th:block th:if="${r.status.name() == 'PROGRAMADA'}">
                                <a th:href="@{/coord/reunioes/{id}/pauta(id=${r.id})}" class="btn btn-sm btn-outline-primary"
                                   title="Gerenciar Pauta">
                                    <i class="bi bi-list-check"></i>
                                </a>
                                <a th:href="@{/coord/reunioes/editar/{id}(id=${r.id})}" class="btn btn-sm btn-outline-secondary"
                                   title="Editar">
                                    <i class="bi bi-pencil"></i>
                                </a>
                                <form th:action="@{/coord/reunioes/{id}/iniciar(id=${r.id})}" method="post" class="d-inline">
                                    <button type="submit" class="btn btn-sm btn-success" title="Iniciar Sessao"
                                            onclick="return confirm('Deseja iniciar esta sessao?')">
                                        <i class="bi bi-play-fill"></i> Iniciar
                                    </button>
                                </form>
                                <form th:action="@{/coord/reunioes/excluir/{id}(id=${r.id})}" method="post" class="d-inline">
                                    <button type="submit" class="btn btn-sm btn-outline-danger" title="Excluir"
                                            onclick="return confirm('Deseja excluir esta reuniao?')">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </form>
                            </th:block>

                            <!-- Acoes para reuniao EM_ANDAMENTO -->
                            <th:block th:if="${r.status.name() == 'EM_ANDAMENTO'}">
                                <a th:href="@{/coord/reunioes/{id}/conduzir(id=${r.id})}" class="btn btn-sm btn-primary">
                                    <i class="bi bi-broadcast"></i> Conduzir
                                </a>
                            </th:block>

                            <!-- Acoes para reuniao ENCERRADA -->
                            <th:block th:if="${r.status.name() == 'ENCERRADA'}">
                                <span class="text-muted">
                                    <i class="bi bi-check-circle"></i> Finalizada
                                </span>
                            </th:block>
                        </td>
                    </tr>
                    <tr th:if="${#lists.isEmpty(reunioes)}">
                        <td colspan="6" class="text-center text-muted py-4">
                            <i class="bi bi-inbox fs-1 d-block mb-2"></i>
                            Nenhuma reuniao encontrada.
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</section>
</body>
</html>
